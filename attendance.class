#include <fstream>
#include <iostream>
#include <iomanip>
#include <cstdio>
#include <cstring>
#include <stdlib.h>
using namespace std;

class attendance
{
	char name[25];
	int att,ab,total;
public:
	void begin();
	void getdat();
	void show();
	void save();
	void task();
	void update();
	void newm();
	void clear();
	attendance()
	{
		strcpy(name,"NULL");
		att=ab=total=0;
	}
};

void attendance::begin()
{
	clear();
	printf("Welcome to NCS Attendance\n");
	printf("What would you like to do??\n");
	printf("1. Take Attendance\n2. See Attendance record\n");
	printf("3. Update any record\n4. Add new members!\n");
}


void attendance::getdat()
{
	cin.ignore();
	printf("Enter name of Member\n");
	cin.getline(name,sizeof(name));
	printf("Enter attendance (if present earlier/required)\n");
	cin>>att;
	cin.ignore();
}

void attendance::clear()
{
	cout <<"\033[2J\033[1;1H";
}
void attendance::save()
{
	ofstream f1("database.dat",ios::app|ios::binary);
	f1.write((char*)this,sizeof(*this));
	f1.close();
	printf("Data Saved successfully.\n");
}

void attendance::show()
{
	printf("\n\n");
	ifstream f2("database.dat",ios::binary);
	attendance ob;
	f2.read((char*)&ob,sizeof(ob));
	printf("Total Working days- %d \n",ob.total);
	cout<<left<<setw(18)<<"NAME"<<"PRESENCE"<<" | "<<"ABSENCE"<<endl;
	while(!f2.eof())
	{
		ob.total++;
		cout<<left<<setw(25)<<ob.name<<ob.att<<" | "<<ob.ab<<endl;
		f2.read((char*)&ob,sizeof(ob));
	}
	f2.close();
}

void attendance::task()
{
	cin.ignore();
	fstream f3("database.dat",ios::binary|ios::in|ios::out);
	attendance obj;
	f3.read((char*)&obj,sizeof(obj));
	while(!f3.eof())
	{
		cout<<left<<setw(30)<<obj.name<<obj.att<<endl;
		string temp;
		getline(cin,temp);
		if(temp.empty())
			++(obj.att);
		else
			++(obj.ab);
		obj.total++;
		f3.seekp(f3.tellp()-sizeof(obj));
		f3.write((char*)&obj,sizeof(obj));
		f3.read((char*)&obj,sizeof(obj));
	}
	f3.close();
}

void attendance::update()
{
	cin.ignore();
	fstream f4("database.dat",ios::in|ios::out|ios::binary);
	attendance ob;
	int flag=1;
	char ername[25],choice;
	cout<<"Enter the name of Member whose attendance is to be updated\n";
	cin.getline(ername,sizeof(ername));
//	cin.ignore();
	cout<<ername<<endl;
	f4.read((char*)&ob,sizeof(ob));
	while(!f4.eof())
	{
		if(strcmp(ername,ob.name)==0)
		{
			while(1)
			{
				printf("Were you absent or present?? (Y/N)\n");
				cin>>choice;
				if(choice=='Y'||choice=='y')
				{	ob.att++; ob.ab--; break; }
				else if(choice=='N'||choice=='n')
				{	ob.att--; ob.ab++;	break;	}
			else
				printf("Wrong choice\n");
			}
			f4.seekp(f4.tellp()-sizeof(ob));
			f4.write((char*)&ob,sizeof(ob));
			break;
			flag=0;
		}
		f4.read((char*)&ob,sizeof(ob));
	}
	if(flag)
		printf("No record found.\n");
	f4.close();
}

void attendance::newm()
{
	getdat();
	save();
}